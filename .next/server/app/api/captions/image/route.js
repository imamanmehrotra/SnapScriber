"use strict";(()=>{var e={};e.id=285,e.ids=[285],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},2623:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2903:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>d,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{POST:()=>c});var s=r(3278),o=r(5002),n=r(4877),i=r(1309),p=r(6920);async function u(e){let t=await e.arrayBuffer();return Buffer.from(t).toString("base64")}async function c(e){try{let t=await e.formData(),r=t.get("file");if(!(r instanceof File))return i.NextResponse.json({error:"File is required"},{status:400});let a=t.get("tone")||"",s=t.get("creativity")||"",o=t.get("captionLength")||"",n=t.get("language")||"",c=t.get("keywords")||"",l=Number(t.get("numCaptions")||1);if(!a||!s||!o||!n)return i.NextResponse.json({error:"Missing required fields."},{status:400});let g=await u(r),h=`Generate ${l} instagram post captions for this image in ${n} language.
The tone should be ${a}.
The creativity level should be ${s}.
Each caption length should be ${o} words.
Please use at least one of words from: ${c}, while generating captions. If empty, no keyword restriction.
Include relevant and trending hashtags for each caption.
Return ONLY JSON in this format:
{
  "Caption 1": {"text": "some text", "hashtag": "#few-hashtags"},
  "Caption 2": {"text": "another text", "hashtag": "#another-hashtags"}
}`,m=await p.M.chat.completions.create({messages:[{role:"user",content:[{type:"text",text:h},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${g}`}}]}],model:"meta-llama/llama-4-maverick-17b-128e-instruct",response_format:{type:"json_object"},top_p:1,temperature:"High"===s?.8:"Medium"===s?.7:.6,max_tokens:"10 - 20"===o?300:"20 - 80"===o?700:"80 - 140"===o?1e3:1200,seed:42,n:1}),d=m.choices[0]?.message?.content||"{}",x=function(e){try{let t=JSON.parse(e);return Object.values(t).map(e=>({text:e.text??"",hashtag:e.hashtag??""}))}catch(e){return[]}}(d);return i.NextResponse.json({captions:x})}catch(e){return console.error("image caption error",e),i.NextResponse.json({error:e?.message||"Server error"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/captions/image/route",pathname:"/api/captions/image",filename:"route",bundlePath:"app/api/captions/image/route"},resolvedPagePath:"/Users/81221574/Desktop/Personal_Files_Folders/Learnings/CaptionGen/web/app/api/captions/image/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:m}=l,d="/api/captions/image/route";function x(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},6920:(e,t,r)=>{r.d(t,{M:()=>s});var a=r(5934);if(!process.env.GROQ_API_KEY)throw Error("GROQ_API_KEY is not set. Add it to your Vercel envs.");let s=new a.ZP({apiKey:process.env.GROQ_API_KEY})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[787,966],()=>r(2903));module.exports=a})();